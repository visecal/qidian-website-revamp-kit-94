"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8203],{50552:function(e,t,n){n.r(t),n.d(t,{TransitionLink:function(){return d},routerPush:function(){return s}});var a=n(57437),i=n(87138),r=n(16463);n(2265);var o=n(59355);let s=async e=>{let{router:t,href:n,callback:a}=e,i=document.querySelector(".main-container");null!==i&&(i.classList.add("page-transition"),await new Promise(e=>{setTimeout(e,100)}),n&&t.push((0,o.VF)(n)),a&&a(()=>null==i?void 0:i.classList.remove("page-transition")))},d=e=>{let{children:t,href:n,...d}=e,c=(0,r.useRouter)(),u=async e=>{e.preventDefault(),window.location.href!==(0,o.VF)(n)&&s({href:n,router:c})};return(0,a.jsx)(i.default,{prefetch:!1,...d,href:(0,o.VF)(n),onClick:u,children:t})}},612:function(e,t,n){n.d(t,{u:function(){return m}});var a=n(62737),i=n.n(a),r=n(22170),o=n.n(r),s=n(50104),d=n.n(s),c=n(67655),u=n.n(c),l=n(2265),g=n(94876),f=n(40904);let m=()=>{let{data:e,reading:t}=(0,f.CG)(e=>e.me),n=(0,f.TL)(),[a,r]=(0,l.useState)([]),s=(0,l.useCallback)(function(e,t){var n,a;let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{index:e.index,title:e.title,bookId:e.bookId,createdAt:r?i()().format("YYYY-MM-DD HH:mm:ss"):i()(e.createdAt).format("YYYY-MM-DD HH:mm:ss"),book:t?{slug:t.slug,title:t.title,author:{name:null===(n=t.author)||void 0===n?void 0:n.name},genre:{name:null===(a=t.genre)||void 0===a?void 0:a.name}}:void 0}},[]),c=(0,l.useCallback)(o()(function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{server:!0},i=JSON.stringify(JSON.parse(t).map(e=>s(e,e.book,!1)));localStorage.setItem("readings",i),a.server&&(null==e?void 0:e.id)&&n((0,g.Ry)({data:{content:i}})),r(u()(JSON.parse(i),"createdAt","desc"))},500),[n,null==e?void 0:e.id]),m=(0,l.useCallback)(e=>{c(JSON.stringify(JSON.parse(localStorage.getItem("readings")||"[]").filter(t=>t.bookId!==e.bookId)))},[c]);return(0,l.useEffect)(()=>{r(u()(JSON.parse(localStorage.getItem("readings")||"[]"),"createdAt","desc"))},[]),(0,l.useEffect)(()=>{(null==e?void 0:e.id)&&d()(t)&&n((0,g.Sn)())},[null==e?void 0:e.id,t]),(0,l.useEffect)(()=>{if(!d()(t)){let e=localStorage.getItem("readings");if(t.content){if(e){if(e!==t.content){let n=JSON.parse(t.content),a=JSON.parse(e||"[]"),r=n.reduce((e,t)=>({...e,[t.bookId]:t}),{});a.forEach(e=>{r[e.bookId]?r[e.bookId]=i()(r[e.bookId].createdAt).isAfter(i()(e.createdAt))?r[e.bookId]:e:r[e.bookId]=e}),c(JSON.stringify(u()(Object.values(r),"createdAt","desc")))}}else c(t.content,{server:!1})}else e&&c(e)}},[t]),{data:a,remove:m,syncData:c,generateReading:s}}},21661:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(71768),i=n(38472),r=n(10462),o=n.n(r);let s=e=>new TextEncoder().encode(e),d=e=>Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""),c=async(e,t,n)=>{let a=JSON.stringify({path:e,timestamp:t}),i=s(n),r=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return d(await crypto.subtle.sign("HMAC",r,s(a)))},u=i.Z.create({baseURL:"/api"});u.interceptors.request.use(async e=>{var t;let n=localStorage.getItem("token"),a={...e};n&&(a.headers.Authorization=n),a.headers["Content-Type"]||(a.headers["Content-Type"]="application/json");let i=Date.now();a.headers["X-Timestamp"]=i;let r="/api".concat(null===(t=e.url)||void 0===t?void 0:t.split("?")[0]),o=await c(r,i,"qidian-vp-lam-nguoi-di-ban");return a.headers["X-Signature"]=o,a},e=>Promise.reject(e)),u.interceptors.response.use(e=>e,e=>{console.log(e);let{data:{message:t}}=e.response,{config:{headers:{ignoreApiAlertMsg:n}},data:{errors:i}}=e.response;return n||(t||(t=e.response.message),!t&&i&&(t=i[0].message?i.map(e=>e.message):i[0].messages?o()(i.map(e=>e.messages)):i),t&&Array.isArray(t)&&(t=t.join(",")),t&&"object"==typeof t||(401===e.response.status?a.ZP.error("Chưa đăng nhập"):a.ZP.error(t||"Error happened"))),Promise.reject(e)});var l=u},94876:function(e,t,n){n.d(t,{DO:function(){return d},Lq:function(){return u},Mt:function(){return l},Ry:function(){return f},Sn:function(){return g},XM:function(){return c},aM:function(){return o},rv:function(){return m}});var a=n(66862),i=n(71768),r=n(21661);let o=(0,a.hg)("me/FETCH_ME",async()=>await r.Z.get("/me?timestamp=".concat(Date.now())).then(e=>e.data)),s=(0,a.hg)("me/LOAD_LOGS",async()=>await r.Z.get("/me/cultivation-logs").then(e=>e.data)),d=(0,a.hg)("me/UPDATE_ME",async e=>{let{data:t,successCallback:n,hideMessage:a}=e,o=await r.Z.put("/me",t).then(e=>e.data);return o.success?(a||i.ZP.success(o.message),n&&n()):i.ZP.error(o.message),o}),c=(0,a.hg)("me/SET_ME",async e=>{let{me:t,replace:n=!0}=e;return{me:t,replace:n}}),u=(0,a.hg)("me/SET_ME_BY_CALLBACK",async(e,t)=>{let{callback:n}=e,{data:a}=t.getState().me;return n(a)}),l=(0,a.hg)("me/ASK_CODE",async e=>{let{params:{email:t},successCallback:n}=e,a=await r.Z.post("/me/ask-code",{email:t}).then(e=>e.data);return a.success?(i.ZP.success(a.message),n&&n()):i.ZP.error(a.message),a}),g=(0,a.hg)("me/FETCH_ME_READING",async()=>await r.Z.get("/me/reading").then(e=>e.data)),f=(0,a.hg)("me/UPDATE_ME_READING",async e=>{let{data:t}=e;return await r.Z.put("/me/reading",t).then(e=>e.data)}),m=(0,a.hg)("me/SET_USER_ITEM_BY_CALLBACK",async(e,t)=>{let{callback:n}=e,{userItems:a}=t.getState().me;return n(a)}),{reducer:h}=(0,a.oM)({name:"me",initialState:{userItems:[],pagination:{currentPage:1,perPage:20},fetching:!1,isSubmitting:!1,itemResources:{userHasMainPhapBao:!1,daoCuList:[],phapBaoList:[],devourableItems:[],phaCamChams:[],availableGems:[],giaiThachPhu:0,batHoaiPhu:0}},reducers:{},extraReducers:e=>{e.addCase(o.pending,e=>({...e,fetching:!0})).addCase(o.fulfilled,(e,t)=>({...e,data:t.payload,fetching:!1})).addCase(o.rejected,e=>({...e,fetching:!1})).addCase(s.pending,e=>({...e,fetching:!0})).addCase(s.fulfilled,(e,t)=>e.data?{...e,data:{...e.data,cultivationLogs:t.payload},fetching:!1}:{...e,fetching:!1}).addCase(s.rejected,e=>({...e,fetching:!1})).addCase(d.pending,e=>({...e,isSubmitting:!0})).addCase(d.fulfilled,e=>({...e,isSubmitting:!1})).addCase(d.rejected,e=>({...e,isSubmitting:!1})).addCase(l.pending,e=>({...e,isSubmitting:!0})).addCase(l.fulfilled,e=>({...e,isSubmitting:!1})).addCase(l.rejected,e=>({...e,isSubmitting:!1})).addCase(g.pending,e=>({...e,fetching:!0})).addCase(g.fulfilled,(e,t)=>({...e,fetching:!1,reading:t.payload})).addCase(g.rejected,e=>({...e,fetching:!1})).addCase(f.pending,e=>({...e,isSubmitting:!0})).addCase(f.fulfilled,(e,t)=>({...e,isSubmitting:!1,reading:t.payload})).addCase(f.rejected,e=>({...e,isSubmitting:!1})).addCase(m.fulfilled,(e,t)=>{let n=t.payload,a=function(e,t){let n=e.filter(e=>"daocu"===e.itemType),a=e.filter(e=>"phapbao"===e.itemType),i=e.filter(e=>"phapbao"===e.itemType&&!e.isMain&&!e.isLocked&&!e.using),r=e.filter(e=>"daocu"===e.itemType&&e.name.endsWith(" Thạch")),o=e.filter(e=>"daocu"===e.itemType&&"Ph\xe1 Cấm Ch\xe2m"===e.name),s=e.filter(e=>"daocu"===e.itemType&&"Giải Thạch Ph\xf9"===e.name).reduce((e,t)=>e+t.amount,0),d=e.filter(e=>"daocu"===e.itemType&&"Bất Hoại Ph\xf9"===e.name).reduce((e,t)=>e+t.amount,0);return{userHasMainPhapBao:a.some(e=>e.isMain),devourableItems:i,daoCuList:n,phapBaoList:a,phaCamChams:o,availableGems:r,giaiThachPhu:s,batHoaiPhu:d}}(n);return{...e,userItems:n,itemResources:a}}).addCase(c.fulfilled,(e,t)=>{let{me:n,replace:a}=t.payload;return a?{...e,data:n}:{...e,data:{...e.data,...n}}}).addCase(u.fulfilled,(e,t)=>({...e,data:t.payload}))}});t.ZP=h},40904:function(e,t,n){n.d(t,{CG:function(){return r},TL:function(){return i}});var a=n(11444);let i=a.I0.withTypes(),r=a.v9.withTypes();a.oR.withTypes()},59355:function(e,t,n){n.d(t,{df:function(){return c},l:function(){return u},SV:function(){return i},Lt:function(){return d},VF:function(){return r},F2:function(){return o},vs:function(){return s}}),n(38544),n(67655);var a=n(71524);n(20357);let i=()=>"https://qidian-vp.com",r=e=>new URL(e,i()).toString(),o=e=>e?(0,a.BW)(e):"",s=e=>{let{name:t,isBad:n}=e;return n||0===t.trim().length?"[Qidian-VP.com]":t.length>30?(0,a.BW)([t.slice(0,10)," [Qidian-VP.com] ",t.slice(t.length-10,t.length)].join("")):(0,a.BW)(t)},d=e=>RegExp("^\\s*(?:\\p{Extended_Pictographic}(?:\\uFE0F)?(?:\\p{Emoji_Modifier})?(?:\\u200D\\p{Extended_Pictographic}(?:\\uFE0F)?(?:\\p{Emoji_Modifier})?)*\\s*)+$","u").test(e),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return e.reduce((e,n)=>(t in n&&(e[n[t]]=n),e),{})},u=e=>e.reduce((e,t)=>(e[t]=!0,e),{})},71524:function(e,t,n){n.d(t,{BW:function(){return m}});var a=n(38544),i=n.n(a);let r=["địt","lồn","cặc","đ\xe9o","admin","ch\xf3","dog","s\xfac","dm","buồi","giết","hiếp","d\xe2m","dục","đm","v\xfa","s\xfang","đạn","chết","chặt đầu","con cặc","đụ m\xe1","đụ mẹ","địt mẹ","s\xfac vật","ngu lồn","bắt c\xf3c","tống tiền","phản quốc","phản động","nội tạng","cờ bạc","t\xe0i xỉu"],o=e=>e?e.normalize("NFC"):"",s=()=>({children:{},isEndOfWord:!1,word:""}),d=(()=>{let e=s();for(let t of r){let n=e,a=o(t.toLowerCase());for(let e of a)n.children[e]||(n.children[e]=s()),n=n.children[e];n.isEndOfWord=!0,n.word=a}return e})(),c=e=>e.length<100,u=e=>!e||RegExp("[\\s\\p{P}\\p{Z}\\p{S}]","u").test(e),l=[...r].sort((e,t)=>t.length-e.length).map(e=>o(e)),g=e=>{if(!e)return"";let t=o(e);for(let e of l){let n=o(e.toLowerCase()),a=!n.includes(" "),r=a?RegExp("(?:^|[\\s\\p{P}\\p{Z}\\p{S}])".concat(i()(n),"(?=[\\s\\p{P}\\p{Z}\\p{S}]|$)"),"giu"):RegExp(i()(n),"gi");t=t.replace(r,e=>{if(a){let t=e.toLowerCase().indexOf(n.toLowerCase());return -1===t?e:e.substring(0,t)+e.substring(t,t+n.length).split("").join("\xb7")}return e.split("").join("\xb7")})}return t},f=e=>{if(!e)return"";let t=o(e),n=t.toLowerCase(),a=[],i=0;for(;i<n.length;){let e=d,r=-1,o=i,s=0===i||u(n[i-1]);for(;o<n.length;){let t=n[o];if(!t||!e.children[t])break;if((e=e.children[t]).isEndOfWord){let{word:t}=e,a=!t.includes(" "),i=o===n.length-1||u(n[o+1]);(!a||s&&i)&&(r=o)}o+=1}if(-1!==r){let e=t.substring(i,r+1);a.push(e.split("").join("\xb7")),i=r+1}else a.push(t[i]),i+=1}return a.join("")},m=e=>c(e)?g(e):f(e),h={};r.forEach(e=>{e.includes(" ")||(h[o(e.toLowerCase())]=!0)})},95889:function(e,t,n){n.d(t,{$L:function(){return o},KI:function(){return r}});let a=e=>{let t=Math.floor(e/1e3),n=Math.floor(t/60),a=Math.floor(n/60),i=Math.floor(a/24),r=Math.floor(i/30),o=Math.floor(r/12);return o>0?"".concat(o," năm"):r>0?"".concat(r," th\xe1ng"):i>0?"".concat(i," ng\xe0y"):a>0?"".concat(a," giờ"):n>0?"".concat(n," ph\xfat"):"".concat(t," gi\xe2y")},i=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e instanceof Date?t?new Date(e.toISOString().replace(/T|Z/g," ")):e:new Date(t?e.replace(/T|Z/g," "):e)},r=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=new Date,r=i(e,t),o=n.getTime()-r.getTime();return"".concat(a(o)," trước")},o=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=new Date,r=i(e,t).getTime()-n.getTime();return"".concat(a(r)," nữa")}}}]);